<!DOCTYPE html>
<html>
<head>
    <style>body, html { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; }</style>
</head>
<body>
    <div id="player"></div>

    <script>
        // Récupérer les params URL (ex: ?v=VIDEO_ID&time=10&type=youtube)
        const params = new URLSearchParams(window.location.search);
        const videoId = params.get('v');
        const videoType = params.get('type');
        const startTime = params.get('t') || 0;

        let player;
        let twitchPlayer;

        // --- YOUTUBE API ---
        if (videoType === 'youtube') {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            document.head.appendChild(tag);

            window.onYouTubeIframeAPIReady = function() {
                player = new YT.Player('player', {
                    height: '100%',
                    width: '100%',
                    videoId: videoId,
                    playerVars: {
                        'playsinline': 1,
                        'autoplay': 1,
                        'controls': 0,
                        'start': parseInt(startTime),
                        'origin': window.location.origin // Origine valide HTTPS !
                    },
                    events: {
                        'onReady': (event) => {
                            event.target.playVideo();
                            // Signaler au NUI que c'est prêt (optionnel)
                        }
                    }
                });
            };
        }
        
        // --- TWITCH ---
        else if (videoType === 'twitch') {
             const script = document.createElement('script');
             script.src = "https://player.twitch.tv/js/embed/v1.js";
             script.onload = () => {
                 const options = {
                    width: '100%',
                    height: '100%',
                    channel: videoId,
                    parent: [window.location.hostname, "localhost"] // Important pour Twitch
                };
                twitchPlayer = new Twitch.Player("player", options);
             };
             document.head.appendChild(script);
        }

        // --- ECOUTER LES ORDRES DU NUI (FIVEM) ---
        window.addEventListener('message', function(event) {
            // Sécurité: tu peux vérifier event.origin ici si tu veux être strict
            
            const data = event.data;
            if(!data) return;

            // Logique YouTube
            if (videoType === 'youtube' && player && player.playVideo) {
                if (data.action === 'volume') player.setVolume(data.value);
                if (data.action === 'pause') player.pauseVideo();
                if (data.action === 'play') player.playVideo();
            }
            
            // Logique Twitch
            if (videoType === 'twitch' && twitchPlayer) {
                if (data.action === 'volume') twitchPlayer.setVolume(data.value / 100);
                if (data.action === 'pause') twitchPlayer.pause();
                if (data.action === 'play') twitchPlayer.play();
            }
        });
    </script>
</body>
</html>